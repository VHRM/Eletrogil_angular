import{b as q,c as G,d as W,e as X,f as Y,g as Z,h as ee,i as te,j as ae,k as oe,l as re,m as le,n as de,o as se}from"./chunk-3UCGB6JA.js";import{a as z,b as f,d as B,e as j,f as $,h as p,i as L,j as H,k as J,l as K,n as Q,p as U}from"./chunk-DFX25S2J.js";import{O as ie,P as ne,a as R,ea as me}from"./chunk-5PSWDFSM.js";import{$b as T,Ga as c,Ha as u,Ja as P,Ka as N,La as E,Ma as a,Na as t,Oa as s,Qb as w,R as h,Xa as I,Ya as O,Zb as A,ac as k,cc as V,kb as i,lb as D,ma as l,mb as F,ta as y}from"./chunk-25W2ZKBC.js";function ce(n,e){return this.possibleStatuses}function ue(n,e){if(n&1&&(a(0,"h2"),i(1),t()),n&2){let o=O();l(),F("Editando nota ",o.id)}}function fe(n,e){n&1&&(a(0,"h2"),i(1,"Criar nota"),t())}function ge(n,e){n&1&&(a(0,"mat-error"),i(1,"Nome do cliente \xE9 obrigat\xF3rio"),t())}function he(n,e){if(n&1&&(a(0,"mat-option",8),i(1),t()),n&2){let o=e.$implicit;E("value",o),l(),D(o)}}function Ce(n,e){n&1&&(a(0,"mat-error"),i(1,"CPF inv\xE1lido"),t())}function ve(n,e){n&1&&(a(0,"mat-error"),i(1,"Telefone do cliente \xE9 obrigat\xF3rio"),t())}function _e(n,e){n&1&&(a(0,"mat-error"),i(1,"Tipo do aparelho \xE9 obrigat\xF3rio"),t())}function Ee(n,e){n&1&&(a(0,"mat-error"),i(1,"Marca do aparelho \xE9 obrigat\xF3rio"),t())}function be(n,e){n&1&&(a(0,"mat-error"),i(1,"Modelo do aparelho \xE9 obrigat\xF3rio"),t())}function xe(n,e){n&1&&(a(0,"mat-error"),i(1,"Data de Entrada \xE9 obrigat\xF3rio"),t())}function Se(n,e){n&1&&(a(0,"mat-error"),i(1,"Garantia \xE9 obrigat\xF3rio"),t())}function Me(n,e){n&1&&(a(0,"mat-error"),i(1,"Valor do or\xE7amento \xE9 obrigat\xF3rio"),t())}function ye(n,e){n&1&&(a(0,"mat-error"),i(1,"Or\xE7amento \xE9 obrigat\xF3rio"),t())}function Pe(n,e){n&1&&(a(0,"div",26),s(1,"mat-spinner",27),t())}var pe=class n{id;createId;loading=!0;possibleStatuses=["Pe\xE7as Solicitadas","N\xE3o feito","Arrumado","Entregue"];form=new $({nomeCliente:new p("",[f.required,f.minLength(3)]),cpfCliente:new p("",[this.cpfValidator()]),telefoneCliente:new p("",[f.required]),tipoAparelho:new p("",[f.required]),marcaAparelho:new p("",[f.required]),modeloAparelho:new p("",[f.required]),dataEntrada:new p("",[f.required]),dataRetirada:new p("",[]),orcamento:new p("",[f.required]),orcamentoValor:new p("",[]),garantia:new p("",[]),obs:new p("",[]),status:new p("",[f.required])});notaService=h(R);snackbar=h(me);route=h(A);router=h(T);constructor(){console.log(this.route.snapshot.paramMap.get("id")),this.id=this.route.snapshot.paramMap.get("id")??void 0,this.notaService.initialize().subscribe(e=>{if(!e){this.snackbar.open("Falha ao inicializar planilha. Tente novamente.","Fechar",{duration:5e3});return}this.notaService.setSheetId(e),this.id?this.notaService.getNotaByOs(Number.parseInt(this.id)).subscribe(o=>{o?(this.form.setValue(this.mapNotaToFormValue(o)),this.loading=!1):this.snackbar.open("Erro ao carregar dados. Tente novamente.","Fechar",{duration:5e3}).afterDismissed().subscribe(()=>{this.router.navigate(["/home"])})}):this.notaService.getNotas().subscribe(o=>{console.log(o),this.createId=o.length.toString(),this.loading=!1})})}ngOnInit(){}cpfValidator(){return e=>{if(e.value.length==0)return null;let o=(e.value||"").replace(/\D/g,"");if(o.length!==11)return{cpfInvalid:!0};if(/^(\d)\1{10}$/.test(o))return{cpfInvalid:!0};let r=0;for(let m=0;m<9;m++)r+=parseInt(o.charAt(m))*(10-m);let d=r*10%11;if((d===10||d===11)&&(d=0),d!==parseInt(o.charAt(9)))return{cpfInvalid:!0};r=0;for(let m=0;m<10;m++)r+=parseInt(o.charAt(m))*(11-m);return d=r*10%11,(d===10||d===11)&&(d=0),d!==parseInt(o.charAt(10))?{cpfInvalid:!0}:null}}save(e){if(console.log("entrei"),e.preventDefault(),console.log("passei"),this.form.markAllAsTouched(),console.log(this.form),this.form.valid){let o=this.mapFormValueToNota(this.form);console.log(o),console.log(this.id),this.id?this.notaService.updateNota(o).subscribe(r=>{console.log(r),r&&this.snackbar.open("Salvo com sucesso!","Fechar",{duration:3e3,panelClass:["snackbar-success"]}).afterDismissed().subscribe(()=>{this.router.navigate(["/home"])})}):this.notaService.saveNota(this.createId??-1,o).subscribe(r=>{this.snackbar.open("Salvo com sucesso!","Fechar",{duration:3e3,panelClass:["snackbar-success"]}).afterDismissed().subscribe(()=>{this.router.navigate(["/home"])})})}}mapNotaToFormValue(e){return{nomeCliente:e.cliente.nome,telefoneCliente:e.cliente.telefone,cpfCliente:e.cliente.cpf??"",tipoAparelho:e.aparelho.tipo,marcaAparelho:e.aparelho.marca,modeloAparelho:e.aparelho.modelo,dataEntrada:e.dataEntrada.toISOString().substring(0,10),dataRetirada:e.dataRetirada?e.dataRetirada.toISOString().substring(0,10):"",orcamento:e.orcamento,orcamentoValor:(e.valorOrcamento??0).toString(),garantia:(e.garantia??0).toString(),obs:e.obs??"",status:e.status}}mapFormValueToNota(e){let[o,r,d]=e.get("dataEntrada").value.split("-").reverse().map(Number),m=new Date(d,r-1,o),g;if(e.get("dataRetirada")?.value){let[C,v,_]=e.get("dataRetirada").value.split("-").reverse().map(Number);g=new Date(_,v-1,C)}return{aparelho:{marca:e.get("marcaAparelho")?.value??"",modelo:e.get("modeloAparelho")?.value??"",tipo:e.get("tipoAparelho")?.value??""},cliente:{nome:e.get("nomeCliente")?.value??"",cpf:e.get("cpfCliente")?.value,telefone:e.get("telefoneCliente")?.value??""},dataEntrada:m,dataRetirada:g,garantia:e.get("garantia")?.value,orcamento:e.get("orcamento")?.value??"",valorOrcamento:e.get("orcamentoValor")?.value,obs:e.get("obs")?.value??"",numeroOs:this.id??0,status:e.get("status")?.value}}static \u0275fac=function(o){return new(o||n)};static \u0275cmp=y({type:n,selectors:[["app-details-page"]],decls:91,vars:13,consts:[[1,"nota-form"],[1,"title","separator"],[3,"formGroup"],[1,"cliente","separator"],[1,"inputs"],[1,"half-width"],["type","text","matInput","","formControlName","nomeCliente"],["type","text","matInput","","formControlName","status"],[3,"value"],["type","text","mask","000.000.000-00","matInput","","formControlName","cpfCliente"],["type","text","mask","90000-0000","matInput","","formControlName","telefoneCliente"],[1,"aparelho","separator"],[1,"full-width"],["type","text","matInput","","formControlName","tipoAparelho"],["type","text","matInput","","formControlName","marcaAparelho"],["type","text","matInput","","formControlName","modeloAparelho"],[1,"servico","separator"],["type","date","matInput","","formControlName","dataEntrada"],["type","date","matInput","","formControlName","dataRetirada"],["type","number","matInput","","formControlName","garantia"],["type","text","mask","separator.2","thousandSeparator",".","decimalMarker",",","prefix","R$ ","matInput","","formControlName","orcamentoValor"],["cdkTextareaAutosize","","type","text","matInput","","formControlName","orcamento"],["cdkTextareaAutosize","","type","text","matInput","","formControlName","obs"],[1,"botoes"],["matButton","outlined","routerLink","/home",1,"add-btn"],["matButton","filled",1,"add-btn",3,"click"],[1,"overlay"],["diameter","200"]],template:function(o,r){if(o&1&&(a(0,"div",0)(1,"div",1),c(2,ue,2,1,"h2")(3,fe,2,0,"h2"),t(),a(4,"form",2)(5,"div",3)(6,"span"),i(7,"Cliente"),t(),a(8,"div",4)(9,"mat-form-field",5)(10,"mat-label"),i(11,"Nome"),t(),s(12,"input",6),c(13,ge,2,0,"mat-error"),t(),a(14,"mat-form-field",5)(15,"mat-label"),i(16,"Status"),t(),a(17,"mat-select",7),P(18,he,2,2,"mat-option",8,ce,!0),t()(),a(20,"mat-form-field",5)(21,"mat-label"),i(22,"CPF"),t(),s(23,"input",9),c(24,Ce,2,0,"mat-error"),t(),a(25,"mat-form-field",5)(26,"mat-label"),i(27,"Telefone"),t(),s(28,"input",10),c(29,ve,2,0,"mat-error"),t()()(),a(30,"div",11)(31,"span"),i(32,"Aparelho"),t(),a(33,"div",4)(34,"mat-form-field",12)(35,"mat-label"),i(36,"Tipo"),t(),s(37,"input",13),c(38,_e,2,0,"mat-error"),t(),a(39,"mat-form-field",12)(40,"mat-label"),i(41,"Marca"),t(),s(42,"input",14),c(43,Ee,2,0,"mat-error"),t(),a(44,"mat-form-field",12)(45,"mat-label"),i(46,"Modelo"),t(),s(47,"input",15),c(48,be,2,0,"mat-error"),t()()(),a(49,"div",16)(50,"span"),i(51,"Servi\xE7o"),t(),a(52,"div",4)(53,"mat-form-field",5)(54,"mat-label"),i(55,"Data Entrada"),t(),s(56,"input",17),c(57,xe,2,0,"mat-error"),t(),a(58,"mat-form-field",5)(59,"mat-label"),i(60,"Data Retirada"),t(),s(61,"input",18),t(),a(62,"mat-form-field",5)(63,"mat-label"),i(64,"Garantia (em dias)"),t(),s(65,"input",19),c(66,Se,2,0,"mat-error"),t(),a(67,"mat-form-field",5)(68,"mat-label"),i(69,"Valor do Or\xE7amento"),t(),s(70,"input",20),c(71,Me,2,0,"mat-error"),t(),a(72,"mat-form-field",12)(73,"mat-label"),i(74,"Or\xE7amento"),t(),s(75,"textarea",21),c(76,ye,2,0,"mat-error"),t(),a(77,"mat-form-field",12)(78,"mat-label"),i(79,"Obs.:"),t(),s(80,"textarea",22),t()()(),a(81,"div",23)(82,"a",24)(83,"mat-icon"),i(84,"cancel"),t(),i(85,"Cancelar"),t(),a(86,"button",25),I("click",function(m){return r.save(m)}),a(87,"mat-icon"),i(88,"add"),t(),i(89,"Salvar"),t()()()(),c(90,Pe,2,0,"div",26)),o&2){let d,m,g,C,v,_,b,x,S,M;l(2),u(r.id?2:3),l(2),E("formGroup",r.form),l(9),u((d=r.form.get("nomeCliente"))!=null&&d.hasError("required")?13:-1),l(5),N(r.possibleStatuses),l(6),u((m=r.form.get("cpfCliente"))!=null&&m.hasError("cpfInvalid")?24:-1),l(5),u((g=r.form.get("telefoneCliente"))!=null&&g.hasError("required")?29:-1),l(9),u((C=r.form.get("tipoAparelho"))!=null&&C.hasError("required")?38:-1),l(5),u((v=r.form.get("marcaAparelho"))!=null&&v.hasError("required")?43:-1),l(5),u((_=r.form.get("modeloAparelho"))!=null&&_.hasError("required")?48:-1),l(9),u((b=r.form.get("dataEntrada"))!=null&&b.hasError("required")?57:-1),l(9),u((x=r.form.get("garantia"))!=null&&x.hasError("required")?66:-1),l(5),u((S=r.form.get("orcamentoValor"))!=null&&S.hasError("required")?71:-1),l(5),u((M=r.form.get("orcamento"))!=null&&M.hasError("required")?76:-1),l(14),u(r.loading?90:-1)}},dependencies:[Z,Y,W,X,ae,te,ee,Q,L,z,H,B,j,J,K,G,q,ne,ie,U,V,k,se,de,w,le,re,oe],styles:[".nota-form[_ngcontent-%COMP%]{margin:0 auto;width:calc(100% - 32px);box-sizing:border-box}.nota-form[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font:var(--mat-sys-display-small);margin:12px 0}.nota-form[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]{width:100%;margin-bottom:12px;border-bottom:1px solid var(--mat-sys-primary);display:flex;align-items:flex-start;justify-content:space-between}.nota-form[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]:last-child{border-bottom:none}.nota-form[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{font:var(--mat-sys-title-medium);width:25%}.nota-form[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]   .inputs[_ngcontent-%COMP%]{width:70%;display:flex;flex-wrap:wrap;align-items:center;justify-content:space-between}.nota-form[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]   .inputs[_ngcontent-%COMP%]   .full-width[_ngcontent-%COMP%]{width:100%}.nota-form[_ngcontent-%COMP%]   .separator[_ngcontent-%COMP%]   .inputs[_ngcontent-%COMP%]   .half-width[_ngcontent-%COMP%]{width:calc(50% - 16px)}.nota-form[_ngcontent-%COMP%]   .botoes[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;gap:16px;justify-content:flex-end}.overlay[_ngcontent-%COMP%]{position:absolute;top:0;bottom:0;z-index:1;background-color:#f5f5f5;display:flex;align-items:center;justify-content:center;height:100%;width:100%}"]})};export{pe as DetailsPage};
